name: ✅ Repo Policy (Structure Gate)

on:
  pull_request:
  push:
    branches: [main, develop]

permissions:
  contents: read

jobs:
  policy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Check required paths
        run: |
          pip install pyyaml
          python - << 'PY'
          import yaml, sys, os

          with open(".github/policies/required-paths.yml") as f:
              cfg = yaml.safe_load(f)

          missing = []
          for p in cfg.get("required", []):
              if not os.path.exists(p):
                  missing.append(p)

          if missing:
              print("❌ Missing required paths:")
              for p in missing:
                  print(" -", p)
              sys.exit(1)

          print("✅ Repository structure validated.")
          PY