global:
  resolve_timeout: 5m

route:
  receiver: slack-default
  group_by: ["alertname", "service", "instance", "severity"]
  group_wait: 15s
  group_interval: 5m
  repeat_interval: 2h
  routes:
    - matchers:
        - severity="critical"
      receiver: slack-critical
      repeat_interval: 30m
    - matchers:
        - severity="warning"
      receiver: slack-default

inhibit_rules:
  - source_matchers: ["severity=critical"]
    target_matchers: ["severity=warning"]
    equal: ["alertname", "service", "instance"]

receivers:
  - name: slack-default
    slack_configs:
      - api_url: ${SLACK_WEBHOOK_URL}
        channel: ${ALERTS_SLACK_CHANNEL}
        send_resolved: true
        title: "[{{ .Status | toUpper }}] {{ .CommonLabels.alertname }} ({{ .CommonLabels.severity }})"
        text: >
          {{ range .Alerts -}}
          â€¢ *{{ .Annotations.summary }}*
            service={{ .Labels.service }} instance={{ .Labels.instance }}
            runbook={{ .Labels.runbook_url }}
          {{ "\n" -}}
          {{ end }}

  - name: slack-critical
    slack_configs:
      - api_url: ${SLACK_WEBHOOK_URL}
        channel: ${ALERTS_SLACK_CHANNEL}
        send_resolved: true
        title: "ðŸš¨ [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }} (CRITICAL)"
        text: >
          {{ range .Alerts -}}
          â€¢ *{{ .Annotations.summary }}*
            {{ .Annotations.description }}
            service={{ .Labels.service }} instance={{ .Labels.instance }}
            runbook={{ .Labels.runbook_url }}
          {{ "\n" -}}
          {{ end }}